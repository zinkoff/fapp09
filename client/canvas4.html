<!doctype html>
<html>
<head>

    <link href="canvas4.css" rel="stylesheet" type="text/css">
	<script src='canvas4.js'></script>

<title>/Users/tosti/Sites/canvas.tosti.info/html5-canvas-drawing-app-master/index_javascript-med-save.html</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />

	<script type="text/javascript">





function selectColor(el){
    for(var i=0;i<document.getElementsByClassName("palette").length;i++){
        document.getElementsByClassName("palette")[i].style.borderColor = "#777";
        document.getElementsByClassName("palette")[i].style.borderStyle = "solid";
    }
    el.style.borderColor = "#fff";
    el.style.borderStyle = "dashed";
    color = window.getComputedStyle(el).backgroundColor;
    ctx.beginPath();
    ctx.strokeStyle = color;
}

// prototype to	start drawing on touch using canvas moveTo and lineTo
var drawTouch = function() {
	var start = function(e) {
		ctx.beginPath();
		x = e.changedTouches[0].pageX;
		y = e.changedTouches[0].pageY-44;
		ctx.moveTo(x,y);
	};
	var move = function(e) {
		e.preventDefault();
		x = e.changedTouches[0].pageX;
		y = e.changedTouches[0].pageY-44;
		ctx.lineTo(x,y);
		ctx.stroke();
	};
    document.getElementById("canvas").addEventListener("touchstart", start, false);
	document.getElementById("canvas").addEventListener("touchmove", move, false);
};

// prototype to	start drawing on pointer(microsoft ie) using canvas moveTo and lineTo
var drawPointer = function() {
	var start = function(e) {
        e = e.originalEvent;
		ctx.beginPath();
		x = e.pageX;
		y = e.pageY-44;
		ctx.moveTo(x,y);
	};
	var move = function(e) {
		e.preventDefault();
        e = e.originalEvent;
		x = e.pageX;
		y = e.pageY-44;
		ctx.lineTo(x,y);
		ctx.stroke();
    };
    document.getElementById("canvas").addEventListener("MSPointerDown", start, false);
	document.getElementById("canvas").addEventListener("MSPointerMove", move, false);
};

// prototype to	start drawing on mouse using canvas moveTo and lineTo
var drawMouse = function() {
	var clicked = 0;
	var start = function(e) {
		clicked = 1;
		ctx.beginPath();
		x = e.pageX;
		y = e.pageY-44;
		ctx.moveTo(x,y);
	};
	var move = function(e) {
		if(clicked){
			x = e.pageX;
			y = e.pageY-44;
			ctx.lineTo(x,y);
			ctx.stroke();
		}
	};
	var stop = function(e) {
		clicked = 0;
	};
    document.getElementById("canvas").addEventListener("mousedown", start, false);
	document.getElementById("canvas").addEventListener("mousemove", move, false);
	document.addEventListener("mouseup", stop, false);
};

//	tosti:
function save() {
    document.getElementById("canvasimg").style.border = "0";//"2px solid";
    var dataURL = canvas.toDataURL();alert(dataURL);
    document.getElementById("canvasimg").src = dataURL;
    document.getElementById("canvasimg").style.display = "inline";
      document.getElementById("canvasimg").style.background='url(/assets/images/flora.jpg);background:contain;';
}

	</script>
	<script>
	function save2(dURL){


"use strict";var c=document.getElementById("canvas");
var ctx=c.getContext("2d");
var imageObj1 = new Image();
var imageObj2 = new Image();
imageObj1.src = "http://ks.tosti.info/api/files/p4dl5k1456614651832.png";
imageObj2.src = dURL;
ctx.drawImage(imageObj2, 0, 0, 328, 526);

	ctx.drawImage(imageObj2, 0, 0, 328, 526);
      ctx.drawImage(imageObj2, 15, 85, 300, 300);
      var img = c.toDataURL("image/png");
      document.write('<img src="' + img + '" width="328" height="526"/>');

}
	</script>
	<script type="text/javascript">
	function save3(dURL){

var img1 = "http://ks.tosti.info/api/files/p4dl5k1456614651832.png";
var img2 = dURL;
alert(img2);
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');

canvas.width = img1.width;
canvas.height = img1.height;

context.globalAlpha = 1.0;
context.drawImage(img1, 0, 0);
context.globalAlpha = 0.5; //Remove if pngs have alpha
context.drawImage(img2, 0, 0);

}
</script>
<script>var img = canvas.toDataURL("image/png");
      document.write('<img src="' + img + '" width="328" height="526"/>');

function link2mail(body){
alert(body);
document.write('<form  style="background:orange;" method="POST" action="http://ks.tosti.info/canvas/postoffice/sendmail.php"><input type="hidden" name="message" value="' + body + '"/><input type="hidden" name="subject" value="test canvas"/><input type="submit" value="send billede" /></form>');

}
function sendMail()
{
   var mailBody=document.getElementById('canvas').innerHTML;
   window.location="mailto:tosti@mac.com?subject=hii&body="+mailBody;
}
</script>
</head>
<body>
<div id="page">
    <div class="header">
		<a id="new" class="navbtn" onclick="newCanvas()">New</a>
        <div class="title">Sketch Pad</div>
    </div>
<!--
<style>
#content {
    position: relative;

}

#content canvas {
    position: absolute;
    top: 0;
    left: 0;
}</style>
 -->
    <div id="content" class="content" style="position:relative;">
    	<canvas style="z-index:10;yellow:none;top:0;left:0;margin:0;padding:0;background:url(/assets/images/flora.jpg);background-size: contain;" id="canvas" class="canvas" width="100" height="100"></canvas>
    	<img style="background:url(/assets/images/flora.jpg);z-index:0;position:relative;top:-3000px;left:-3000px;padding:0;margin:0;width:100%" id="respondImage" src="/assets/images/flora.jpg"/>
    </div>
    <div class="footer">
    	<div>

    		<img id="canvasimg" style="background-size:contain;"/>
    		<input type="button" value="save" id="btn" size="30" onclick="save()" style="background:red;">
    		<input type="button" value="save2" id="btn" size="30" onclick="save3(canvas.toDataURL())" style="background:green;">
    		<input type="button" value="mail" id="btn" size="30" onclick="link2mail(canvas.toDataURL())" style="background:yellow;">
    		<!--
<input type="button" value="mail" id="btn" size="30" onclick="sendMail" style="background:navy;">
    		<a href="mailto:me@me.com?subject=Me&body=%3Chtml%20xmlns%3D%22http:%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3C%2Fhead%3E%3Cbody%3EPlease%20%3Ca%20href%3D%22http:%2F%2Fwww.w3.org%22%3Eclick%3C%2Fa%3E%20me%3C%2Fbody%3E%3C%2Fhtml%3E">html-email</a>
 -->


    	</div>
    		<div class="palette-case">
			<div class="palette-box">
				<div class="palette white" onclick="selectColor(this)"></div>
			</div>
			<div class="palette-box">
				<div class="palette red" onclick="selectColor(this)"></div>
			</div>
			<div class="palette-box">
				<div class="palette orange" onclick="selectColor(this)"></div>
			</div>
			<div class="palette-box">
				<div class="palette blue" onclick="selectColor(this)"></div>
			</div>
			<div class="palette-box">
				<div class="palette green" onclick="selectColor(this)"></div>
			</div>
			<div class="palette-box">
				<div class="palette black" onclick="selectColor(this)"></div>
			</div>

			<div style="clear:both"></div>

		</div>
    </div>
</div>
  <script src="respondCanvas-jquery.js"></script>
  <script>window.jQuery || document.write("<script src='respondCanvas-jquery.js'>\x3C/script>")</script>
<script type="text/javascript">
  	$(document).ready( function(){

  		//Get the canvas & context
  		var c = $('canvas');
  		var ci = $('#canvasimg');
  		//var ct = c.get(0).getContext('2d');
  		var container = $(c).parent();

  		//Run function when browser  resize
	  	$(window).resize( respondCanvas );

	  	function respondCanvas(){
  			c.attr('width', $('#respondImage').width() ); //max width
  			c.attr('height', $('#respondImage').height() ); //max height
			$('#canvasimg').css( "background","url(/assets/images/flora.jpg)" );
			$('#canvasimg').css( "background-size","contain" );
			/*$('#canvasimg').attr('width', $('#respondImage').width() ); //max width
			$('#canvasimg').attr('height', $('#respondImage').height() ); //max width*/

			ctx.lineWidth = $('#respondImage').width()/100;

  			//http://www.sitepoint.com/css3-background-size-property/

  			//Redraw & reposition content
  			var x = c.width();
  			var y = c.height();
  			ctx.font = "20px Calibri";

  			ctx.fillStyle = "#DDDDDD"; //black
  			//ct.fillRect( 0, 0, x, y); //fill the canvas

  			var resizeText = "Canvas2 width: "+c.width()+"px # height: "+c.height();
  			ctx.textAlign = "center";
  			ctx.fillStyle = "#ff0000"; //white
	  		ctx.fillText(resizeText, (x/2), (y/2) );
		}

		//Initial call
		respondCanvas();
  	});



</script>
</body>
</html>
